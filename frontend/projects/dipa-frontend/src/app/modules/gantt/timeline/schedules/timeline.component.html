<div id="gantt" class="gantt" #gantt>
  <div class="content-container">
    <span style="display: flex; margin-bottom: 10px">
      <span class="full-width-spacer"></span>
      <mat-button-toggle-group
        name="chartMetric"
        #group="matButtonToggleGroup"
        multiple
        aria-label="Chart Metric"
        [(ngModel)]="viewTypeSelected"
        (change)="changeViewType($event)"
      >
        <mat-button-toggle class="md-button" value="YEARS">Jahre</mat-button-toggle>
        <mat-button-toggle class="md-button" value="MONTHS">Monate</mat-button-toggle>
        <mat-button-toggle class="md-button" value="WEEKS">Wochen</mat-button-toggle>
        <mat-button-toggle class="md-button" value="DAYS">Tage</mat-button-toggle>
      </mat-button-toggle-group>
    </span>
    <ng-container *ngIf="vm$ | async as vm">
      <app-chart
        #ganttChart
        [timelineData]="vm.selectedTimeline"
        [milestoneData]="vm.milestoneData"
        [taskData]="vm.taskData"
        [incrementsData]="vm.incrementsData"
        id="gantt{{ vm.selectedTimeline.id }}"
        [active]="false"
        [showTitle]="false"
        [projectApproachModifiable]="true"
        [showActions]="true"
        (projectApproachChanged)="setData()"
      ></app-chart>
    </ng-container>
  </div>
</div>
<div *ngIf="appoinmentsList">
  <mat-card class="appointments-card">
    <mat-card-content>
      <div class="matCardContentHeader">
        <div fxLayout="row wrap" fxLayoutGap="10px grid">
          <div
            fxFlex="33%"
            fxFlex.xs="100%"
            fxFlex.sm="100%"
            fxFlex.md="100%"
            fxFlex.lg="100%"
            class="matCardContentHeaderTitle ellipsis"
          >
            Termine
          </div>
          <div fxFlex="33%" fxFlex.xs="100%" fxFlex.sm="100%" fxFlex.md="100%" fxFlex.lg="50%">
            <mat-form-field class="floatLabelNever full-width" floatLabel="never">
              <mat-label>Anzeigezeitraum</mat-label>
              <mat-date-range-input [rangePicker]="durationPicker">
                <input
                  matStartDate
                  placeholder="Start date"
                  [value]="apptStartDate"
                  (dateChange)="onChangeAppointmentPeriodStart($event)"
                />
                <input
                  matEndDate
                  placeholder="End date"
                  [value]="apptEndDate"
                  (dateChange)="onChangeAppointmentPeriodEnd($event)"
                />
              </mat-date-range-input>
              <mat-datepicker-toggle matSuffix [for]="durationPicker"></mat-datepicker-toggle>
              <mat-date-range-picker #durationPicker></mat-date-range-picker>
            </mat-form-field>
          </div>
          <div fxFlex="33%" fxFlex.xs="100%" fxFlex.sm="100%" fxFlex.md="100%" fxFlex.lg="50%">
            <mat-form-field class="floatLabelNever full-width" floatLabel="never">
              <mat-label>Zeitraum</mat-label>
              <mat-select [value]="periodTemplate" (selectionChange)="changePeriodTemplates($event.value)">
                <mat-option *ngFor="let period of schedulePeriods" [value]="period.key">
                  {{ period.value }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </div>
      <ng-container *ngIf="appointmentsInPeriod.length > 0; else noAppointments">
        <div *ngFor="let appt of appointmentsInPeriod" fxLayout="row wrap" fxLayoutGap="16px grid">
          <div fxFlex="33%" *ngFor="let formField of appt.formFields">
            <ng-container *ngIf="formField.key !== 'status'">
              <mat-form-field class="full-width">
                <mat-label>{{ formField.label }}</mat-label>
                <input [type]="formField.type.toLowerCase()" matInput [value]="formField.value" disabled />
              </mat-form-field>
            </ng-container>
            <ng-container *ngIf="formField.key === 'status'">
              <mat-form-field class="full-width">
                <mat-label>{{ formField.label }}</mat-label>
                <mat-select
                  [value]="formField.value"
                  (selectionChange)="changeStatus($event.value, appt.id, formField.id)"
                >
                  <mat-option *ngFor="let opt of formField.options" [value]="opt.key">
                    {{ opt.value }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </ng-container>
          </div>
        </div>
      </ng-container>
      <ng-template #noAppointments>
        <p>Keine Termine im gew√§hlten Zeitraum offen.</p>
      </ng-template>
    </mat-card-content>
  </mat-card>
</div>
