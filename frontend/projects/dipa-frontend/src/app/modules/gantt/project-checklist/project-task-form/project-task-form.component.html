<form [formGroup]="formGroup" (ngSubmit)="onSubmit(formGroup)">
  <mat-form-field style="float: right">
    <mat-label>Felder auswählen</mat-label>
    <mat-select [formControl]="showFieldsForm" (selectionChange)="changeShowSelection($event)" multiple>
      <mat-option *ngFor="let entry of entriesArray.controls" [value]="entry.get('key')?.value">{{
        entry.get('label')?.value
      }}</mat-option>
    </mat-select>
  </mat-form-field>

  <ng-container formArrayName="entries">
    <ng-container *ngFor="let entry of entriesArray.controls; let i = index">
      <ng-container [formGroupName]="i">
        <mat-form-field *ngIf="entry.get('show')?.value">
          <mat-label>{{ entry.get('label')?.value }}</mat-label>

          <div [ngSwitch]="entry.get('controlType')?.value">
            <input
              *ngSwitchCase="'TEXTBOX'"
              matInput
              [placeholder]="entry.get('placeholder').value"
              formControlName="value"
              [id]="entry.get('key')?.value"
              [value]="entry.get('value')?.value"
              (change)="onSubmit(formGroup)"
              (focus)="onFocus($event, ['entries', i, 'value'])"
              (keyup.esc)="onEscape($event, ['entries', i, 'value'])"
            />
            <textarea
              *ngSwitchCase="'TEXTAREA'"
              matInput
              [placeholder]="entry.get('placeholder').value"
              formControlName="value"
              [id]="entry.get('key')?.value"
              [value]="entry.get('value')?.value"
              (change)="onSubmit(formGroup)"
              (focus)="onFocus($event, ['entries', i, 'value'])"
              (keyup.esc)="onEscape($event, ['entries', i, 'value'])"
            >
            </textarea>
            <mat-select *ngSwitchCase="'DROPDOWN'" formControlName="value">
              <mat-option *ngFor="let opt of entry.get('options')?.value" [value]="opt.key">
                {{ opt.value }}
              </mat-option>
            </mat-select>
          </div>
        </mat-form-field>
      </ng-container>
    </ng-container>
  </ng-container>

  <ng-container formGroupName="results">
    <ng-container [ngSwitch]="taskData.results.type">
      <app-cart-form
        *ngSwitchCase="'TYPE_ELBE_SC'"
        [formData]="taskData.results.data"
        (dataChanged)="onSubmit(formGroup)"
      ></app-cart-form>
      <app-risk-form
        *ngSwitchCase="'TYPE_RISK'"
        [formData]="taskData.results.data"
        (dataChanged)="onSubmit(formGroup)"
      ></app-risk-form>
      <app-contact-person-form
        *ngSwitchCase="'TYPE_CONTACT_PERS'"
        [formData]="taskData.results.data"
        (dataChanged)="onSubmit(formGroup)"
      ></app-contact-person-form>
      <app-single-appointment-form
        *ngSwitchCase="'TYPE_SINGLE_APPOINTMENT'"
        [formData]="taskData.results.data"
        (dataChanged)="onSubmit(formGroup)"
      ></app-single-appointment-form>
      <app-appointment-series-form
        *ngSwitchCase="'TYPE_APPT_SERIES'"
        [formData]="taskData.results.data"
        (dataChanged)="onSubmit(formGroup)"
      ></app-appointment-series-form>
      <app-default-task-form *ngSwitchDefault [formData]="taskData.results.data" (dataChanged)="onSubmit(formGroup)">
      </app-default-task-form>
    </ng-container>
  </ng-container>

  <div>
    <button mat-raised-button color="primary" class="stepDoneButton" (click)="toggleCompleteStatus()">
      <mat-icon>{{ formGroup.get('completed').value === true ? 'undo' : 'done' }}</mat-icon>
      {{ formGroup.get('completed').value === true ? 'Schritt bearbeiten' : 'Schritt abschließen' }}
    </button>
  </div>
</form>
