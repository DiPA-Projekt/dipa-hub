<ng-container [formGroup]="formGroupDirective.control">
  <div formArrayName="results">
    <ng-container *ngFor="let result of resultsArray.controls; let i = index">
      <div [formGroupName]="i">
        <button class="countButton" color="primary" disabled mat-mini-fab aria-label="icon with result count">
          {{ i + 1 }}
        </button>
        <ng-container formArrayName="formFields">
          <ng-container *ngFor="let formField of getFormFieldsArray(result).controls; let j = index">
            <ng-container [formGroupName]="j">
              <mat-form-field
                [hintLabel]="formField.get('hint')?.value"
                [ngClass]="getFormFieldClass(formField)"
                *ngIf="formField.get('show')?.value"
              >
                <mat-label>{{ formField.get('label')?.value }}</mat-label>
                <ng-container [ngSwitch]="formField.get('controlType')?.value">
                  <input
                    *ngSwitchCase="'TEXTBOX'"
                    matInput
                    [type]="formField.get('type').value.toLowerCase()"
                    formControlName="value"
                    [id]="formField.get('key')?.value"
                    [value]="formField.get('value')?.value"
                    (change)="dataChanged.emit()"
                    (focus)="onFocus($event, ['results', i, 'formFields', j, 'value'])"
                    (keyup.esc)="onEscape($event, ['results', i, 'formFields', j, 'value'])"
                  />
                  <textarea
                    *ngSwitchCase="'TEXTAREA'"
                    matInput
                    matTextareaAutosize
                    matAutosizeMinRows="1"
                    matAutosizeMaxRows="5"
                    formControlName="value"
                    [id]="formField.get('key')?.value"
                    [value]="formField.get('value')?.value"
                    (change)="dataChanged.emit()"
                    (focus)="onFocus($event, ['results', i, 'formFields', j, 'value'])"
                    (keyup.esc)="onEscape($event, ['results', i, 'formFields', j, 'value'])"
                  >
                  </textarea>
                  <mat-select *ngSwitchCase="'DROPDOWN'" (selectionChange)="dataChanged.emit()" formControlName="value">
                    <mat-option *ngFor="let opt of formField.get('options')?.value" [value]="opt.key">
                      {{ opt.value }}
                    </mat-option>
                  </mat-select>
                </ng-container>
                <mat-error
                  *ngIf="formField.get('value').hasError('email') && !formField.get('value').hasError('required')"
                >
                  Bitte g端ltige E-Mailadresse eingeben
                </mat-error>
                <mat-error
                  *ngIf="formField.get('value').hasError('url') && !formField.get('value').hasError('required')"
                >
                  Bitte g端ltige URL eingeben
                </mat-error>
                <mat-error *ngIf="formField.get('value').hasError('required')"> Bitte Feld ausf端llen </mat-error>
              </mat-form-field>
            </ng-container>
          </ng-container>
        </ng-container>
        <button
          *ngIf="resultsArray.controls.length > 1"
          mat-button
          type="button"
          class="roundedButton"
          (click)="deleteResult(i)"
          title="Eintrag entfernen"
          aria-label="Eintrag entfernen"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </ng-container>

    <span class="">
      <button type="button" mat-button (click)="addResult(getResultType())">
        <mat-icon style="color: rgba(0, 0, 0, 0.65)">add_circle</mat-icon>
        Eintrag hinzuf端gen
      </button>
    </span>
  </div>

  <div *ngIf="getResultType() === 'TYPE_TEAM_PERS'">
    <div style="width: 180px; padding: 10px; margin-top: 10px; background-color: rgba(0, 0, 0, 0.04)">
      <div style="font-size: 14px; font-weight: 500">Zusammenfassung</div>
      <div style="margin-top: 3px">
        geplant:
        <span class="tagBorder" style="font-weight: 500">
          {{ calculatePT({ key: 'status', value: 'PLANNED' }) }} PT
        </span>
      </div>
      <div style="margin-top: 3px">
        besetzt:
        <span class="tagBorder" style="font-weight: 500">
          {{ calculatePT({ key: 'status', value: 'BOOKED' }) }} PT
        </span>
      </div>
    </div>
  </div>
</ng-container>
